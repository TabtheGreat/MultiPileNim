using System;
namespace MultiPileNIM_CSharp
{
	internal class MultiPileNIM
	{
    	public static void Main(string[] args)
    	{
        	// Init variables
        	Random ran = new Random();
		int currentNum1 = ran.Next(1, 10);
		int currentNum2 = ran.Next(1, 10);
		int currentNum3 = ran.Next(1, 10;

		int pile12 = currentNum1 + currentNum2;
		int pile23 = currentNum2 + currentNum3;
		int pile31 = currentNum3 + currentNum1;

        	int takeAmount1 = 0;
		int takeAmount2 = 0;
		int takeAmount3 = 0;

        	int maxTake1;
		int maxTake2;
		int maxTake3;

        	int whoseTurn = 1;
        	bool gameIsOver;
        	bool gameLoop = true;
        	bool validInput;


        	// Main Game Loop
        	if (gameLoop == true)
        	{
            	// Setup
            	maxTake1 = Math.Min(3, currentNum1);
		maxTake2 = Math.Min(3, currentNum2);
		maxTake3 = Math.Min(3, currentNum3);
            	gameIsOver = false;

            	Console.WriteLine("Multiple Pile Nim");

            	//Session Loop
            	while (!gameIsOver)
            	{
                	// Player's Turn
                	validInput = false;
                	whoseTurn = 1;

                	if (!validInput)
                	{
                    	//Get an integer
                    	while (true)
                    	{
                        	Console.WriteLine("Remaining total from the first pile is: {0}", currentNum1);
                        	Console.WriteLine("Remaining total from the second pile is: {0}", currentNum2);
                        	Console.WriteLine("Remaining total from the third pile is: {0}", currentNum3);


                        	Console.WriteLine("How much will you take from the first pile(1-{0})?", maxTake1);
				Console.WriteLine("How much will you take from the second pile(1-{0})?", maxTake2);
				Console.WriteLine("How much will you take from the third pile(1-{0})?", maxTake3);

                        	bool success1 = int.TryParse(Console.ReadLine(), out takeAmount1);
				bool success2 = int.TryParse(Console.ReadLine(), out takeAmount2);
				bool success3 = int.TryParse(Console.ReadLine(), out takeAmount3);

                        	if (success1) 
				{
                            	break;
				}

				else if (success2)
				{
                            	break;
				}

				else if (success3)
				{
                            	break;
				}

                        	else 
				{
                            	Console.WriteLine("Invalid amount!");
				}
                    	}

                    	// Check to see if input is within the valid range
                    	if (takeAmount1 > 0 && takeAmount1 <= maxTake) 
			{
                        	validInput = true;
			}

                    	else
                        	Console.WriteLine("Invalid amount!\n");
                	}

                    	if (takeAmount2 > 0 && takeAmount2 <= maxTake) 
			{
                        	validInput = true;
			}

                    	else
                        	Console.WriteLine("Invalid amount!\n");
                	}

                    	if (takeAmount3 > 0 && takeAmount3 <= maxTake) 
			{
                        	validInput = true;
			}

                    	else
                        	Console.WriteLine("Invalid amount!\n");
                	}

                	Console.WriteLine("You took {0}.\n", takeAmount1);
                	currentNum1 -= takeAmount1;
                	currentNum2 -= takeAmount2;
                	currentNum3 -= takeAmount3;

                	if (currentNum1 <= 0 && currentNum2 <= 0 && currentNum3 <= 0)
                    	gameIsOver = true;

                	else
                	{
                    	//Computer's turn
                    	whoseTurn = 2;
                    	if (pile12 > pile23 && pile12 > pile31)
                    	{
				if (currentNum1 > currentNum2)
				{
                            	takeAmount = currentNum1 + currentNum2 - currentNum3;
                            	Console.WriteLine("I will take from the first pile {0}.\n", takeAmount1);
				}
				else if (currentNum2 > currentNum1)
				{
                            	takeAmount = currentNum1 + currentNum2 - currentNum3;
                            	Console.WriteLine("I will take from the second pile {0}.\n", takeAmount2);
				}
				else
				{

				}

                    	}
			else if (pile12 < pile23 && pile23 > pile31)
                    	{
				if (currentNum2 > currentNum3)
				{
                            	takeAmount2 = currentNum1 + currentNum2 - currentNum3;
                            	Console.WriteLine("I will take from the second pile {0}.\n", takeAmount2);
				}
				if (currentNum3 > currentNum2)
				{
                            	takeAmount3 = currentNum1 + currentNum2 - currentNum3;
                            	Console.WriteLine("I will take from the third pile {0}.\n", takeAmount3);
				}
				else
				{

				}
                    	}
                    	else
                    	{
                        	takeAmount = 1;
                        	Console.WriteLine("I will take {0}.\n", takeAmount);
                    	}
                    	currentNum -= takeAmount;

                    	if (currentNum1 == 0 && currentNum2 == 0 && currentNum3 == 0)
                        	gameIsOver = true;
                	}
            	}

            	// Determine the winner
            	if (whoseTurn == 1)
                	Console.WriteLine("I win, You lose.");

            	else
                	Console.WriteLine("You win, I lose.");

        	}
        	else
        	{
            	Console.WriteLine("\nGoodbye!");
        	}
    	}
	}
}
